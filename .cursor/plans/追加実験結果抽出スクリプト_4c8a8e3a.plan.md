---
name: 追加実験結果抽出スクリプト
overview: 各追加実験のbatch_results.jsonから統計情報を抽出し、論文執筆用のMarkdown形式の表として出力するスクリプトを実装する
todos:
  - id: implement_data_loader
    content: JSONファイル読み込み関数を実装（load_batch_results）
    status: pending
  - id: implement_model_comparison
    content: モデル比較実験の結果抽出関数を実装
    status: pending
    dependencies:
      - implement_data_loader
  - id: implement_fewshot_with_llm
    content: Few-shot実験（LLM評価有効）の結果抽出関数を実装
    status: pending
    dependencies:
      - implement_data_loader
  - id: implement_group_size
    content: Group Size比較実験の結果抽出関数を実装
    status: pending
    dependencies:
      - implement_data_loader
  - id: implement_aspect_desc
    content: アスペクト説明文比較実験の結果抽出関数を実装
    status: pending
    dependencies:
      - implement_data_loader
  - id: implement_coco
    content: COCO実験の結果抽出関数を実装
    status: pending
    dependencies:
      - implement_data_loader
  - id: implement_markdown_generator
    content: Markdown表生成関数を実装
    status: pending
  - id: implement_main
    content: メイン関数を実装し、全実験の結果を統合して出力
    status: pending
    dependencies:
      - implement_model_comparison
      - implement_fewshot_with_llm
      - implement_group_size
      - implement_aspect_desc
      - implement_coco
      - implement_markdown_generator
---

# 追加実験結果抽出スクリプト実装計画

## 目的

各追加実験の`batch_results.json`から統計情報（平均、最小、最大、アスペクト別統計など）を抽出し、論文執筆用のMarkdown形式の表として出力する。

## 実装ファイル

- `論文/結果/追加実験/論文執筆用/結果to表/extract_experiment_results.py`

## 処理対象の実験

1. **モデル比較実験** (`model_comparison_temperature0/実験結果/batch_results.json`)

   - モデル別平均BERTスコア
   - アスペクト別比較表（gpt-4o-mini vs gpt-5.1）

2. **Few-shot実験（LLM評価有効）** (`fewshot_llm_eval/steam/実験結果/batch_results.json`)

   - Few-shot別平均スコア（BERT、LLM）
   - アスペクト別統計

3. **Group Size比較実験** (`group_size_comparison/steam/実験結果/batch_results.json`)

   - Group Size別平均スコア（BERT、LLM）
   - アスペクト別統計

5. **アスペクト説明文比較実験** (`aspect_description_comparison/steam/実験結果/batch_results.json`)

   - 説明文あり/なし別平均スコア
   - アスペクト別対比表

5. **COCO Retrieved Concepts実験** (`results/20251127_140836/batch_results.json` - パス要確認)

   - コンセプト別BERTスコア
   - 平均BERTスコア

## 実装構造

### 1. データ読み込み関数

```python
def load_batch_results(experiment_path: Path) -> Dict
```

- JSONファイルを読み込み、構造を返す
- エラーハンドリング（ファイル不存在、JSONパースエラー）

### 2. 実験タイプ別抽出関数

#### モデル比較実験

```python
def extract_model_comparison(data: Dict) -> Dict[str, Any]
```

- `results`配列から`experiment_info.gpt_model`と`evaluation.bert_score`を抽出
- モデル別平均、アスペクト別比較を計算

#### Few-shot実験（LLM評価有効）

```python
def extract_fewshot_with_llm_results(data: Dict) -> Dict[str, Any]
```

- `results`配列から`experiment_info.few_shot`と評価スコア（BERT、LLM）を抽出
- Few-shot別平均スコア（BERT、LLM）を計算
- アスペクト別統計を計算

#### Group Size比較実験

```python
def extract_group_size_results(data: Dict) -> Dict[str, Any]
```

- `results`配列から`experiment_info.group_size`と評価スコアを抽出
- Group Size別平均、アスペクト別統計を計算

#### アスペクト説明文比較実験

```python
def extract_aspect_description_results(data: Dict) -> Dict[str, Any]
```

- `results`配列から`experiment_info.use_aspect_descriptions`と評価スコアを抽出
- 説明文あり/なし別平均、アスペクト別対比を計算

#### COCO実験

```python
def extract_coco_results(data: Dict) -> Dict[str, Any]
```

- `results`配列からコンセプト別BERTスコアを抽出
- コンセプト別結果、平均を計算

### 3. Markdown表生成関数

```python
def generate_markdown_table(data: Dict, table_type: str) -> str
```

- 抽出したデータをMarkdown形式の表に変換
- `table_type`に応じて適切なフォーマットを適用

### 4. メイン関数

```python
def main() -> None
```

- 各実験のパスを定義
- 各実験の結果を抽出
- Markdown形式で統合レポートを生成
- `結果to表/experiment_results_tables.md`に出力

## 出力形式

### Markdown表の例

```markdown
# 追加実験結果統計表

## 1. モデル比較実験

### モデル別平均BERTスコア

| モデル | 平均BERTスコア | 最小BERTスコア | 最大BERTスコア |
|--------|----------------|----------------|----------------|
| gpt-4o-mini | 0.5402 | 0.5071 | 0.5788 |
| gpt-5.1 | 0.5404 | 0.5254 | 0.5537 |

### アスペクト別比較

| アスペクト | gpt-4o-mini | gpt-5.1 | 差 |
|-----------|-------------|---------|-----|
| gameplay | 0.5788 | 0.5537 | +0.0251 |
...
```

## エラーハンドリング

- ファイル不存在: 警告を出力してスキップ
- JSONパースエラー: エラーメッセージを出力
- データ構造の不一致: 警告を出力して可能な範囲で処理

## 依存関係

- `pathlib.Path`
- `js